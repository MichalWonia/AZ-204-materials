ğŸ”„ What is the Change Feed?
The Change Feed in Azure Cosmos DB is a persistent, ordered log of changes (inserts and updates) to items in a container.
  âœ… Sorted by modification time
  âœ… Asynchronous and incremental processing
  âœ… Changes can be processed by multiple consumers in parallel
  âŒ Deletes are not tracked (you can implement soft deletes with a "deleted": true flag and TTL)

ğŸ› ï¸ Models for Accessing the Change Feed
There are two models for working with the change feed:
  1. Push Model (recommended)
  - You get automatic scaling, partition management, and state tracking
  - Easier to implement and maintain
  Uses:
    - Azure Functions (event-driven)
    - Change Feed Processor Library

  2. Pull Model
  - You write custom logic to poll and track state
  - Gives fine-grained control, useful for:
    - One-time data migrations
    - Reading from specific partition keys
    - Controlling processing pace

âš¡ Push Model Options
ğŸ§© Azure Functions with Cosmos DB Trigger
- Auto-triggered on changes
- Serverless; no infrastructure needed
- Scales automatically
- Based on change feed processor behind the scenes

ğŸ§© Change Feed Processor Library
Works with .NET SDK V3+ and Java SDK V4+. Involves four components:

Component	                  Description
Monitored container	        Source of the change feed
Lease container	            Tracks state of each processor's progress
Compute instance	          Host where processor runs
Delegate	                  Code that processes changes

ğŸ“Œ Sample Setup Code (C#):
ChangeFeedProcessor changeFeedProcessor = cosmosClient
    .GetContainer("dbName", "sourceContainer")
    .GetChangeFeedProcessorBuilder<ToDoItem>(
        processorName: "changeFeedSample",
        onChangesDelegate: HandleChangesAsync)
    .WithInstanceName("consoleHost")
    .WithLeaseContainer(cosmosClient.GetContainer("dbName", "leaseContainer"))
    .Build();

await changeFeedProcessor.StartAsync();

ğŸ“Œ Delegate (Processor Logic):

static async Task HandleChangesAsync(
    ChangeFeedProcessorContext context,
    IReadOnlyCollection<ToDoItem> changes,
    CancellationToken cancellationToken)
{
    Console.WriteLine($"Changes for lease {context.LeaseToken}");

    foreach (ToDoItem item in changes)
    {
        Console.WriteLine($"Detected item ID {item.id}, created at {item.creationTime}");
        await Task.Delay(10); // simulate processing
    }
}

ğŸ” Change Feed Lifecycle
- Check for new changes
- If none â†’ sleep (poll interval)
- If changes â†’ send batch to delegate
- If processing successful â†’ update lease and go back to step 1
